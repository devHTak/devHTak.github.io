---
layout: post
title: SQL Tuning. index 기본
summary: SQL Tuning
author: devhtak
date: '2021-11-03 21:41:00 +0900'
category: SQL
---

#### 테이블 액세스 최소화

- 인덱스를 통해 조회하는 것이 table full scan보다 느릴 때가 있다.
  - 테이블 랜덤 액세스
    - 인덱스 ROWID는 물리적 주소일까, 논리적 주소일까
      - 물리적 주소: 데이터파일 번호, 오브젝트 번호, 블록 번호와 같은 물리적 요소로 구성되어 있다.
      - 논리적 주소: 물리적(포인터)으로 직접 연결되어 있지 않고 테이블 레코드를 찾아가기 위한 논리적 주소 정보를 담고 있다
      - 그래서 논리적 주소에 더 가깝다
    - 메인 메모리 DB와 비교
      - 메인 메모리 DB는 모든 데이터를 메인 메모리에 로드해 놓고 메모리를 통해서만 I/O 하는 DB
      - 오라클은 데이터 블록이 수시로 버퍼캐시에서 밀려났다가 다시 캐싱되는 데 이럴 때마다 다른 공간에 캐싱되기 때문에 인덱스에서 포인터로 직접 연결할 수 없는 구조
        - 메모리 주소 정보(포인터)가 아닌 디스크 주소 정보(DBA, Data Block Address)를 이용해 해시 알고리즘으로 버퍼 블록을 찾아간다
    - I/O 메커니즘
      - I/O 성능을 높이기 위해 버퍼 캐시를 활용하기 때문에 버퍼 캐시를 찾은 후 데이터를 찾지 못하는 경우 디스크를 찾는 과정을 거친다 
      - 해싱 알고리즘을 통해 버퍼 헤더를 찾고, 헤더 내에서 얻은 포인터로 버퍼 블록을 찾는다.

  - 인덱스 클러스터링 팩터
    - 클러스터링 팩터(Clustering Factor)는 특정 컬럼을 기준으로 같은 값을 갖는 데이터가 서로 모여있는 정도를 의미
    - CF가 좋은 컬럼에 생성한 인덱스는 그만큼 스캔하는 부분이 작기 때문에 좋은 효율을 갖게 된다.
      - 테이블 액세스량에 비해 블록 I/O가 적게 발생하는 것

  - 인덱스 손익분기점
    - Index Range Scan에 의한 테이블 액세스가 Table Full Scan 보다 느려지는 시점을 인덱스 손익분기점이라고 부른다
    - Table Full Scan은 시퀀셜 액세스인 반면, 인덱스 ROWID를 이용한 테이블 액세스는 랜덤 액세스 방식
    - Table Full Scan은 Multiblock I/O인 반면, 인덱스 ROWID는 Single Block I/O 이다

- 인덱스 컬럼 추가
  - 가장 일반적으로 사용하는 튜닝 기법
  - 인덱스를 계속 추가하다 보면 테이블 마다 인덱스가 수십 개씩 달려 인덱스 관리 비용에 증가, DML 부하에 따른 트랜잭션 성능 저하가 발생할 수 있다.
  - 테이블 액세스 단계 필터 조건에 의해 버려지는 레코드가 많을 때, 인덱스에 컬럼을 추가함으로써 성능 효과를 볼 수 있다.
  
- 인덱스만 읽고 처리
  
- 인덱스 구조 테이블

- 클러스터 

#### 부분범위 처리 활용

#### 인덱스 스캔 활용화

#### 인덱스 설계

#### 참고

- 조시형 저자의 개발자를 위한 SQL 튜닝 입문서 친절한 SQL 튜닝
  - https://url.kr/fjm9l2

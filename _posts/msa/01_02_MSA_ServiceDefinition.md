---
layout: post
title: Micro Service Definition
summary: msa 서비스 정의
author: devhtak
date: '2021-06-05 14:41:00 +0900'
category: msa
---

#### 다양한 서비스 분리 기준

- Domain Driven Design
  - 서비스를 분해하는 방법 중 하나로 DDD 개념 이용
  - 논리 데이터 모델의 Subject Area 또는 그 하위 그룹 단위로 표현될 수 있음
  - Main Model <<Context Map>> <-> Sub Model <<Bounded Context>> (-> Dependency <<Sharked Kernel>>)
    - Bounded Context
      - 업무의 독립 단위
      - 업무적 연관성이 높은 기능/데이터를 하나의 Boundary로 구분
      - 서비스 예상 단위
    - Sharked Kernel
      - 두개 이상의 모델에서 공유되는 모듈/데이터
      - 연관 팀이 같이 설계하고 변경에 대해서 서로 협의하여 반영
      - 전체 공통 또는 업무 내 공통
  
- 업무 기능 관점
  - Buisiness Capability > Service
  - 기능 분해도의 Level 2(Sub System) 또는 그 하위 Level로 서비스 분리 가능
  - 각 업무별 기능/비기능 요구사항에 따라 서비스를 더 크게(통합) 또는 더 작게(분리) 정의 가능
  - 중복되지 않고 서비스 간 R&R을 명확히 할 수 있는 단위로 분리
  - Monolith 의 기능분해는 업무 기능 Grouping 또는 모듈화가 목적이라면 MSA에서는 모듈화 뿐 아니라 물리적 서비스 분리, 개별 배포, 장애 격리, 확장성, 관련 조직 등을 고려해야 함
  
- Granularity
  - 서비스의 크기는 코드 라인수 등 정량적으로 정의할 수 있는 것이 아니라, Buisiness Context에 맞게 독립적으로 개발/배포할 수 있는 단위로 결정
  
- Microservice 의 크기
  - 업무중심
    - 기술이 아닌 업무 중심의 단위
    - 데이터 연관성(DDD) 관점, 업무 기능(Business Capability) 관점
    - 업무/서비스 간 영향도/결합도가 낮은 단위(Loosely Coupled Services/Teams)
    - 신규/추가 업무, 변경이 잦은 업무
  - 확장성/장애대응, 독립성/배포
    - 서비스로 분리하면 큰 혜택(확장성, 부하/장애대응, 독립성등)을 볼수있는 단위
    - 장애격리, 빠른 장애 대응으로 비즈니스 피해를 최소화 할 수 있는 단위
    - 개별 실행환경을 구축함으로써, 독립적인 개발, 빌드, 테스트, 배포, 모니터링, 확장이 가능한단위
  - 서비스 기능
    - 서비스 별 최소한의 API를 노출(구현 부분은 숨김, Encapsulation) 하고 API간 통신이 원활한 단위
    - Library 를 공유하거나 유사한 기능들은 하나의 서비스로 통합
  - 변경가능성/성능
    - 상대적으로 작은 서비스일수록 새로 구현해 교체하기가 쉬움
    - 서비스간 프로세스 및 데이터 공유가 빈번한 경우 통합(두 서비스를 동시에 변경할 경우가 빈번한 경우)
    - 서비스간 분리로 인해 허용할수 없는 수준으로 성능 저하가 예상되는 경우 통합
  - 트랜잭션과 일관성
    - 서비스들을 너무 세분화한 경우 분산 트랜잭션 처리, 데이터 일관성/정합성을 고려한 단위
    - 실시간 데이터 정합성이 중요한 경우 하나의 서비스로 통합
  - 최적의기술
    - 신기술 또는 업무 특성에 맞는 최적의 기술 적용이 유연한 단위(No Technology Lock)
  - 조직
    - One service per team (Two Pizza 팀, 8 ~ 12명) 권장
    - 20 ~ 30명 이상 팀이 커지 는경우 팀 또는 서비스 분리
    - 다른 팀에 독립적으로 작업하고 배포할 수 있어야 함
    - 다른 팀과 최소한의 협업을 통해 서비스를 개발하고 배포할 수 있어야 함
  
#### 서비스 정의 정차
  
- 서비스 정의 Step은 서비스 크기의 타당서을 검증해 가는 과정

- 후보 서비스 도출
  - 업무 기능 분해도 기반의 후보 서비스 도출
  - 기능 분해도의 일정 Level을 기준으로 후보 서비스 도출
  
- 후보 서비스 평가
  - 비즈니스 요건에 따른 평가 항목 정의(예: 배포, 트랜잭션, 비즈니스반영)
  - 평가 항목을 바탕으로 후보 서비스를 평가
  - 평가 결과를 바탕으로 서비스 통합/분리
  
- 후보 서비스 연관도 시뮬레이션
  - 후보 서비스 평가 후 조정된 서비스들을 연관도 분석으로 시뮬레이션하여 재조정 가능

- 초기 서비스 정의 (서비스정의서 작성)
  - 후보 서비스 평가 > 후보 서비스 연관도 시뮬레이션 후 초기 서비스 정의
  - 관련화면, Entity, 기능 등을 바탕으로 서비스 정의서 작성
  
  
  
  
